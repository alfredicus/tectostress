import React, { useEffect, useRef, useState } from 'react';
import * as THREE from 'three';
import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';
import { StressSphere } from './views/Sphere';

const StressSphereViewer = () => {
    const containerRef = useRef<HTMLDivElement>(null);
    const [stressSphere, setStressSphere] = useState<StressSphere | null>(null);
    const [renderer, setRenderer] = useState<THREE.WebGLRenderer | null>(null);
    const [scene, setScene] = useState<THREE.Scene | null>(null);
    const [camera, setCamera] = useState<THREE.PerspectiveCamera | null>(null);
    const [controls, setControls] = useState<OrbitControls | null>(null);

    useEffect(() => {
        if (!containerRef.current) return;

        const width = containerRef.current.clientWidth;
        const height = containerRef.current.clientHeight;

        const newRenderer = new THREE.WebGLRenderer({ antialias: true });
        newRenderer.setSize(width, height);
        containerRef.current.appendChild(newRenderer.domElement);

        const newScene = new THREE.Scene();
        newScene.background = new THREE.Color(0xf0f0f0);

        const newCamera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
        newCamera.position.z = 5;

        const ambientLight = new THREE.AmbientLight(0xffffff);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(1, 1, 1);
        newScene.add(ambientLight);
        newScene.add(directionalLight);

        const newControls = new OrbitControls(newCamera, newRenderer.domElement);
        newControls.enableDamping = true;

        const newStressSphere = new StressSphere(1);
        newScene.add(newStressSphere.getObject());

        newStressSphere.updateStressState(1, 0, -1);
        // newStressSphere.addIntegralCurve({ theta: 45, phi: 45 });
        // newStressSphere.addEquipotentialCurve({ theta: 45, phi: 45 });
        // newStressSphere.addPoint({ normal: new THREE.Vector3(-0.73240E+00, 0.66110E+00, -0.16300E+00), color: 0xffffff })

        const normals = [[-0.7324, 0.6611, -0.163], [-0.7323, 0.6612, -0.1632], [-0.7321, 0.6613, -0.1635], [-0.732, 0.6614, -0.1637], [-0.7316, 0.6617, -0.1642], [-0.7313, 0.6619, -0.1647], [-0.7311, 0.662, -0.165], [-0.7308, 0.6623, -0.1652], [-0.7305, 0.6626, -0.1655], [-0.7302, 0.6628, -0.1657], [-0.7302, 0.6628, -0.1659], [-0.7301, 0.6629, -0.1661], [-0.73, 0.6629, -0.1662], [-0.7299, 0.6631, -0.1663], [-0.7297, 0.6632, -0.1664], [-0.7296, 0.6633, -0.1665], [-0.7295, 0.6634, -0.1666], [-0.7293, 0.6635, -0.1667], [-0.7293, 0.6636, -0.1668], [-0.7293, 0.6635, -0.1668], [-0.7293, 0.6635, -0.1669], [-0.7292, 0.6636, -0.167], [-0.7291, 0.6637, -0.1671], [-0.729, 0.6638, -0.1671], [-0.7289, 0.6639, -0.1672], [-0.7287, 0.664, -0.1673], [-0.7286, 0.6642, -0.1675], [-0.7285, 0.6643, -0.1676], [-0.7284, 0.6643, -0.1677], [-0.7285, 0.6642, -0.1677], [-0.7285, 0.6642, -0.1677], [-0.7285, 0.6642, -0.1676], [-0.7286, 0.6641, -0.1677], [-0.7286, 0.6641, -0.1677], [-0.7286, 0.6641, -0.1677], [-0.7286, 0.6641, -0.1677], [-0.7286, 0.6641, -0.1678], [-0.7285, 0.6641, -0.1678], [-0.7285, 0.6642, -0.1678], [-0.7286, 0.6641, -0.1678], [-0.7286, 0.6641, -0.1678], [-0.7286, 0.6641, -0.1678], [-0.7286, 0.664, -0.1678], [-0.7287, 0.664, -0.1678], [-0.7287, 0.664, -0.1678], [-0.7287, 0.664, -0.1677], [-0.7287, 0.664, -0.1677], [-0.7287, 0.664, -0.1676], [-0.7288, 0.6639, -0.1675], [-0.7288, 0.6639, -0.1674], [-0.7288, 0.664, -0.1674], [-0.7286, 0.6641, -0.1675], [-0.7285, 0.6642, -0.1674], [-0.7284, 0.6644, -0.1673], [-0.7284, 0.6644, -0.1674], [-0.7283, 0.6645, -0.1674], [-0.7282, 0.6645, -0.1675], [-0.7282, 0.6646, -0.1675], [-0.7282, 0.6646, -0.1676], [-0.7282, 0.6645, -0.1676], [-0.7282, 0.6645, -0.1677], [-0.7282, 0.6645, -0.1677], [-0.7282, 0.6645, -0.1678], [-0.7283, 0.6643, -0.1679], [-0.7285, 0.6642, -0.1679], [-0.7286, 0.664, -0.1679], [-0.7288, 0.6638, -0.1679], [-0.729, 0.6636, -0.1679], [-0.7291, 0.6635, -0.1679], [-0.7292, 0.6634, -0.1679], [-0.7293, 0.6633, -0.1679], [-0.7293, 0.6632, -0.168], [-0.7294, 0.6631, -0.168], [-0.7295, 0.663, -0.168], [-0.7296, 0.6629, -0.168], [-0.7297, 0.6628, -0.1681], [-0.7298, 0.6627, -0.1682], [-0.7299, 0.6626, -0.1682], [-0.7299, 0.6625, -0.1683], [-0.73, 0.6624, -0.1684], [-0.73, 0.6624, -0.1684], [-0.7301, 0.6623, -0.1684], [-0.7302, 0.6622, -0.1684], [-0.7303, 0.6621, -0.1683], [-0.7304, 0.662, -0.1683], [-0.7305, 0.6618, -0.1684], [-0.7306, 0.6617, -0.1684], [-0.7307, 0.6616, -0.1684], [-0.7308, 0.6615, -0.1684], [-0.7308, 0.6615, -0.1684], [-0.7309, 0.6614, -0.1683], [-0.731, 0.6613, -0.1683], [-0.731, 0.6613, -0.1683], [-0.731, 0.6613, -0.1683], [-0.7311, 0.6612, -0.1682], [-0.7311, 0.6612, -0.1681], [-0.7312, 0.6612, -0.1682], [-0.7312, 0.6611, -0.1682], [-0.7313, 0.661, -0.1682], [-0.7314, 0.6609, -0.1682], [-0.7315, 0.6608, -0.1682], [-0.7317, 0.6606, -0.1682], [-0.7319, 0.6604, -0.1682], [-0.732, 0.6603, -0.1682], [-0.732, 0.6602, -0.1682], [-0.7321, 0.6601, -0.1682], [-0.7322, 0.66, -0.1681], [-0.7323, 0.6599, -0.1681], [-0.7324, 0.6598, -0.1681], [-0.7325, 0.6597, -0.1681], [-0.7325, 0.6597, -0.1681], [-0.7326, 0.6596, -0.1681], [-0.7327, 0.6595, -0.1681], [-0.7327, 0.6594, -0.1681], [-0.7328, 0.6594, -0.1681], [-0.7328, 0.6593, -0.1681], [-0.7328, 0.6593, -0.1681], [-0.7328, 0.6593, -0.1682], [-0.7329, 0.6592, -0.1682], [-0.7329, 0.6592, -0.1682], [-0.733, 0.6591, -0.1682], [-0.7331, 0.659, -0.1682], [-0.7331, 0.659, -0.1683], [-0.7331, 0.659, -0.1683], [-0.7331, 0.659, -0.1683], [-0.7331, 0.659, -0.1683], [-0.7331, 0.659, -0.1683], [-0.7331, 0.6589, -0.1684], [-0.7332, 0.6589, -0.1684], [-0.7332, 0.6588, -0.1684], [-0.7332, 0.6588, -0.1684], [-0.7333, 0.6587, -0.1684], [-0.7334, 0.6586, -0.1685], [-0.7334, 0.6586, -0.1685], [-0.7334, 0.6586, -0.1685], [-0.7334, 0.6586, -0.1685], [-0.7333, 0.6587, -0.1684], [-0.7333, 0.6587, -0.1684], [-0.7333, 0.6587, -0.1684], [-0.7334, 0.6587, -0.1684], [-0.7334, 0.6586, -0.1684], [-0.7334, 0.6585, -0.1685], [-0.7335, 0.6585, -0.1685], [-0.7335, 0.6585, -0.1685], [-0.7335, 0.6585, -0.1684], [-0.7335, 0.6585, -0.1685], [-0.7334, 0.6585, -0.1686], [-0.7334, 0.6586, -0.1686], [-0.7333, 0.6586, -0.1686], [-0.7333, 0.6587, -0.1686], [-0.7333, 0.6587, -0.1686], [-0.7332, 0.6587, -0.1687], [-0.7332, 0.6587, -0.1688], [-0.7332, 0.6587, -0.1688], [-0.7332, 0.6587, -0.1688], [-0.7332, 0.6587, -0.1688], [-0.7333, 0.6586, -0.1688], [-0.7333, 0.6586, -0.1688], [-0.7333, 0.6586, -0.1688], [-0.7332, 0.6587, -0.1689], [-0.7331, 0.6588, -0.169], [-0.733, 0.6588, -0.169], [-0.733, 0.6589, -0.1691], [-0.733, 0.6589, -0.1691], [-0.7329, 0.6589, -0.1692], [-0.7329, 0.6589, -0.1693], [-0.7329, 0.659, -0.1694], [-0.7328, 0.659, -0.1695], [-0.7327, 0.659, -0.1695], [-0.7327, 0.6591, -0.1696], [-0.7327, 0.6591, -0.1695], [-0.7327, 0.6591, -0.1696], [-0.7327, 0.6591, -0.1696], [-0.7327, 0.6591, -0.1696], [-0.7327, 0.6591, -0.1695], [-0.7328, 0.6591, -0.1695], [-0.7328, 0.659, -0.1694], [-0.7329, 0.659, -0.1693], [-0.7328, 0.659, -0.1693], [-0.7328, 0.6591, -0.1693], [-0.7327, 0.6591, -0.1694], [-0.7327, 0.6591, -0.1695], [-0.7326, 0.6592, -0.1696], [-0.7325, 0.6593, -0.1696], [-0.7325, 0.6593, -0.1697], [-0.7324, 0.6594, -0.1698], [-0.7324, 0.6594, -0.1698], [-0.7323, 0.6595, -0.1697], [-0.7322, 0.6596, -0.1697], [-0.7321, 0.6597, -0.1698], [-0.7321, 0.6597, -0.1698], [-0.732, 0.6598, -0.1698], [-0.732, 0.6598, -0.1698], [-0.7321, 0.6597, -0.1699], [-0.7322, 0.6596, -0.1699], [-0.7322, 0.6596, -0.1699], [-0.7322, 0.6595, -0.1699], [-0.7323, 0.6594, -0.17], [-0.7323, 0.6594, -0.17], [-0.7323, 0.6594, -0.17], [-0.7323, 0.6594, -0.1699], [-0.7323, 0.6594, -0.1699], [-0.7323, 0.6594, -0.17], [-0.7323, 0.6594, -0.17], [-0.7323, 0.6594, -0.1701], [-0.7323, 0.6594, -0.1701], [-0.7323, 0.6594, -0.1701], [-0.7322, 0.6595, -0.1701], [-0.7321, 0.6596, -0.1701], [-0.7321, 0.6597, -0.1701], [-0.7321, 0.6597, -0.1701], [-0.7321, 0.6596, -0.17], [-0.7321, 0.6597, -0.17], [-0.7321, 0.6597, -0.17], [-0.7321, 0.6597, -0.17], [-0.732, 0.6597, -0.1701], [-0.732, 0.6597, -0.1701], [-0.732, 0.6597, -0.1702], [-0.732, 0.6596, -0.1703], [-0.7321, 0.6596, -0.1703], [-0.7321, 0.6595, -0.1704], [-0.7321, 0.6595, -0.1704], [-0.7321, 0.6595, -0.1705], [-0.7321, 0.6595, -0.1705], [-0.7321, 0.6595, -0.1706], [-0.7321, 0.6595, -0.1706], [-0.7321, 0.6595, -0.1706], [-0.7321, 0.6595, -0.1706], [-0.7321, 0.6595, -0.1706], [-0.7321, 0.6595, -0.1706], [-0.7321, 0.6594, -0.1706], [-0.7321, 0.6594, -0.1706], [-0.7322, 0.6594, -0.1705], [-0.7322, 0.6594, -0.1705], [-0.7322, 0.6594, -0.1706], [-0.7322, 0.6593, -0.1706], [-0.7323, 0.6593, -0.1706], [-0.7322, 0.6593, -0.1706], [-0.7322, 0.6594, -0.1706], [-0.7322, 0.6593, -0.1706], [-0.7322, 0.6593, -0.1707], [-0.7323, 0.6592, -0.1708], [-0.7324, 0.6591, -0.1708], [-0.7324, 0.6591, -0.1708], [-0.7324, 0.6591, -0.1708], [-0.7324, 0.6591, -0.1707], [-0.7324, 0.6591, -0.1706], [-0.7324, 0.6591, -0.1705], [-0.7324, 0.6592, -0.1704], [-0.7324, 0.6592, -0.1703], [-0.7324, 0.6592, -0.1702], [-0.7324, 0.6593, -0.1702], [-0.7325, 0.6592, -0.1702], [-0.7325, 0.6591, -0.1701], [-0.7326, 0.6591, -0.17], [-0.7326, 0.6591, -0.1699], [-0.7326, 0.6591, -0.1698], [-0.7326, 0.6591, -0.1698], [-0.7326, 0.6591, -0.1698], [-0.7326, 0.6591, -0.1698], [-0.7326, 0.6592, -0.1698], [-0.7326, 0.6592, -0.1697], [-0.7326, 0.6592, -0.1697], [-0.7325, 0.6592, -0.1697], [-0.7325, 0.6593, -0.1697], [-0.7324, 0.6593, -0.1696], [-0.7325, 0.6593, -0.1697], [-0.7325, 0.6593, -0.1697], [-0.7325, 0.6593, -0.1696], [-0.7325, 0.6593, -0.1696], [-0.7325, 0.6593, -0.1696], [-0.7326, 0.6592, -0.1696], [-0.7326, 0.6592, -0.1695], [-0.7327, 0.6592, -0.1695], [-0.7327, 0.6591, -0.1694], [-0.7327, 0.6591, -0.1694], [-0.7328, 0.659, -0.1694], [-0.7328, 0.659, -0.1694], [-0.7329, 0.6589, -0.1695], [-0.7329, 0.6589, -0.1695], [-0.733, 0.6588, -0.1695], [-0.7331, 0.6587, -0.1694], [-0.7331, 0.6587, -0.1694], [-0.7331, 0.6587, -0.1693], [-0.7331, 0.6587, -0.1693], [-0.7332, 0.6586, -0.1693], [-0.7333, 0.6585, -0.1693], [-0.7333, 0.6585, -0.1693], [-0.7333, 0.6585, -0.1693], [-0.7333, 0.6585, -0.1693], [-0.7333, 0.6585, -0.1693], [-0.7333, 0.6585, -0.1693], [-0.7334, 0.6584, -0.1692], [-0.7334, 0.6584, -0.1693], [-0.7335, 0.6583, -0.1693], [-0.7336, 0.6582, -0.1692], [-0.7337, 0.6581, -0.1692], [-0.7338, 0.658, -0.1692], [-0.7339, 0.6579, -0.1692], [-0.7339, 0.6578, -0.1692], [-0.734, 0.6577, -0.1692], [-0.7341, 0.6577, -0.1692], [-0.7341, 0.6576, -0.1692], [-0.7341, 0.6576, -0.1692], [-0.7342, 0.6575, -0.1692], [-0.7342, 0.6575, -0.1693], [-0.7343, 0.6574, -0.1693], [-0.7343, 0.6574, -0.1693], [-0.7343, 0.6574, -0.1692], [-0.7343, 0.6574, -0.1691], [-0.7343, 0.6575, -0.169], [-0.7343, 0.6575, -0.169], [-0.7343, 0.6575, -0.169], [-0.7344, 0.6574, -0.169], [-0.7344, 0.6573, -0.1689], [-0.7345, 0.6573, -0.169], [-0.7345, 0.6573, -0.169], [-0.7345, 0.6573, -0.1689], [-0.7345, 0.6573, -0.1689], [-0.7345, 0.6572, -0.1689], [-0.7346, 0.6572, -0.1689], [-0.7346, 0.6571, -0.1689], [-0.7346, 0.6571, -0.1689], [-0.7347, 0.6571, -0.1689], [-0.7347, 0.657, -0.1689], [-0.7348, 0.6569, -0.1689], [-0.7348, 0.6569, -0.169], [-0.7349, 0.6568, -0.169], [-0.7349, 0.6568, -0.169], [-0.7349, 0.6568, -0.1689], [-0.735, 0.6567, -0.1689], [-0.735, 0.6566, -0.1689], [-0.7351, 0.6566, -0.1689], [-0.7351, 0.6566, -0.1688], [-0.7352, 0.6566, -0.1687], [-0.7352, 0.6566, -0.1686], [-0.7352, 0.6566, -0.1685], [-0.7353, 0.6566, -0.1684], [-0.7353, 0.6566, -0.1682], [-0.7353, 0.6565, -0.1681], [-0.7354, 0.6565, -0.1681], [-0.7354, 0.6566, -0.1678], [-0.7352, 0.6568, -0.1676], [-0.7351, 0.6569, -0.1674], [-0.7351, 0.6571, -0.1671], [-0.735, 0.6572, -0.1669], [-0.7349, 0.6573, -0.1667], [-0.7348, 0.6575, -0.1665], [-0.7346, 0.6577, -0.1663], [-0.7346, 0.6578, -0.1663], [-0.7345, 0.6579, -0.1662], [-0.7345, 0.658, -0.1661], [-0.7344, 0.6581, -0.166], [-0.7343, 0.6582, -0.1657], [-0.7343, 0.6583, -0.1656], [-0.7341, 0.6586, -0.1653], [-0.734, 0.6587, -0.1652], [-0.734, 0.6587, -0.1652], [-0.7339, 0.6588, -0.1653], [-0.7338, 0.6589, -0.1654], [-0.7338, 0.6589, -0.1656], [-0.734, 0.6585, -0.1665], [-0.7341, 0.6583, -0.1668], [-0.734, 0.6583, -0.1669], [-0.734, 0.6582, -0.167], [-0.734, 0.6583, -0.1671], [-0.734, 0.6583, -0.1672], [-0.734, 0.6582, -0.1673], [-0.734, 0.6582, -0.1674], [-0.7341, 0.6581, -0.1675], [-0.7341, 0.6581, -0.1675], [-0.734, 0.6581, -0.1677], [-0.734, 0.6581, -0.1678], [-0.734, 0.6581, -0.1678], [-0.734, 0.6581, -0.168], [-0.734, 0.6581, -0.168], [-0.7339, 0.6581, -0.168], [-0.7339, 0.6582, -0.168], [-0.7338, 0.6583, -0.1681], [-0.7338, 0.6583, -0.1681], [-0.7338, 0.6582, -0.1681], [-0.7338, 0.6583, -0.1681], [-0.7337, 0.6583, -0.1681], [-0.7337, 0.6584, -0.1682], [-0.7336, 0.6585, -0.1682], [-0.7335, 0.6586, -0.1682], [-0.7334, 0.6586, -0.1682], [-0.7334, 0.6587, -0.1681], [-0.7333, 0.6588, -0.1681], [-0.7332, 0.6589, -0.168], [-0.7332, 0.6589, -0.1679], [-0.7333, 0.6589, -0.1678], [-0.7333, 0.6588, -0.1678], [-0.7334, 0.6588, -0.1679], [-0.7334, 0.6588, -0.1679], [-0.7333, 0.6588, -0.1678], [-0.7333, 0.6589, -0.1678], [-0.7333, 0.6589, -0.1677], [-0.7333, 0.659, -0.1677], [-0.7332, 0.659, -0.1677], [-0.733, 0.6592, -0.1676], [-0.733, 0.6593, -0.1676], [-0.7329, 0.6594, -0.1675], [-0.7329, 0.6594, -0.1675], [-0.7328, 0.6595, -0.1674], [-0.7327, 0.6597, -0.1674], [-0.7326, 0.6597, -0.1674], [-0.7326, 0.6598, -0.1674], [-0.7326, 0.6598, -0.1673], [-0.7325, 0.6599, -0.1672], [-0.7325, 0.66, -0.1672], [-0.7324, 0.66, -0.1671], [-0.7323, 0.6601, -0.1671], [-0.7322, 0.6603, -0.1671], [-0.7319, 0.6606, -0.167], [-0.7318, 0.6607, -0.167], [-0.7318, 0.6608, -0.167], [-0.7317, 0.6609, -0.1669], [-0.7316, 0.661, -0.1669], [-0.7314, 0.6612, -0.1666], [-0.7313, 0.6614, -0.1665], [-0.7313, 0.6615, -0.1664], [-0.7312, 0.6616, -0.1663], [-0.7312, 0.6616, -0.1662], [-0.7311, 0.6617, -0.1661], [-0.7311, 0.6618, -0.1661], [-0.731, 0.6618, -0.1661], [-0.731, 0.6618, -0.166], [-0.7309, 0.662, -0.166], [-0.7309, 0.662, -0.1659], [-0.7309, 0.6621, -0.1658], [-0.7309, 0.6621, -0.1657], [-0.7308, 0.6622, -0.1656], [-0.7308, 0.6622, -0.1656], [-0.7307, 0.6623, -0.1655], [-0.7307, 0.6624, -0.1654], [-0.7307, 0.6624, -0.1653], [-0.7306, 0.6625, -0.1653], [-0.7306, 0.6626, -0.1652], [-0.7305, 0.6627, -0.1651], [-0.7304, 0.6627, -0.1651], [-0.7304, 0.6628, -0.165], [-0.7304, 0.6628, -0.1649], [-0.7304, 0.6628, -0.1649], [-0.7303, 0.6629, -0.1648], [-0.7303, 0.6629, -0.1649], [-0.7303, 0.6629, -0.1649], [-0.7303, 0.6629, -0.1649], [-0.7304, 0.6628, -0.1649], [-0.7304, 0.6628, -0.1649], [-0.7305, 0.6627, -0.165], [-0.7305, 0.6627, -0.1651], [-0.7304, 0.6628, -0.1652], [-0.7303, 0.6628, -0.1653], [-0.7302, 0.6629, -0.1654], [-0.7302, 0.6629, -0.1654], [-0.7302, 0.6629, -0.1654], [-0.7302, 0.6629, -0.1655], [-0.7301, 0.663, -0.1656], [-0.73, 0.6631, -0.1656], [-0.73, 0.663, -0.1657], [-0.7299, 0.6631, -0.1657], [-0.7298, 0.6633, -0.1656], [-0.7297, 0.6634, -0.1657], [-0.7296, 0.6635, -0.1657], [-0.7295, 0.6636, -0.1657], [-0.7295, 0.6637, -0.1656], [-0.7294, 0.6637, -0.1656], [-0.7293, 0.6638, -0.1655], [-0.7292, 0.664, -0.1654], [-0.7292, 0.664, -0.1653], [-0.7292, 0.664, -0.1654], [-0.7292, 0.664, -0.1654], [-0.7292, 0.6641, -0.1654], [-0.7292, 0.664, -0.1655], [-0.7291, 0.6641, -0.1654], [-0.7291, 0.6641, -0.1654], [-0.729, 0.6642, -0.1655], [-0.7289, 0.6643, -0.1656], [-0.7289, 0.6643, -0.1656], [-0.7288, 0.6643, -0.1656], [-0.7288, 0.6644, -0.1657], [-0.7288, 0.6644, -0.1657], [-0.7288, 0.6644, -0.1657], [-0.7287, 0.6645, -0.1657], [-0.7286, 0.6646, -0.1656], [-0.7286, 0.6647, -0.1656], [-0.7286, 0.6647, -0.1656], [-0.7285, 0.6647, -0.1656], [-0.7271, 0.6651, -0.1702], [-0.7271, 0.665, -0.1705], [-0.727, 0.6651, -0.1707], [-0.7268, 0.6652, -0.171], [-0.7267, 0.6653, -0.1712], [-0.7267, 0.6651, -0.1719], [-0.7267, 0.6651, -0.172], [-0.7266, 0.6651, -0.1721], [-0.7266, 0.6652, -0.1722], [-0.7266, 0.6651, -0.1724], [-0.7266, 0.665, -0.1725], [-0.7267, 0.6649, -0.1727], [-0.7267, 0.6648, -0.1729], [-0.7267, 0.6648, -0.1731], [-0.7268, 0.6647, -0.1733], [-0.7268, 0.6647, -0.1734], [-0.7268, 0.6646, -0.1734], [-0.7268, 0.6645, -0.1735], [-0.7269, 0.6645, -0.1736], [-0.7269, 0.6644, -0.1738], [-0.727, 0.6643, -0.1739], [-0.727, 0.6643, -0.174], [-0.7269, 0.6643, -0.1741], [-0.7268, 0.6644, -0.1742], [-0.7268, 0.6644, -0.1744], [-0.7267, 0.6644, -0.1746], [-0.7267, 0.6644, -0.1747], [-0.7267, 0.6643, -0.1749], [-0.7267, 0.6643, -0.175], [-0.7267, 0.6642, -0.1752], [-0.7268, 0.6642, -0.1752], [-0.7268, 0.6641, -0.1752], [-0.7268, 0.6641, -0.1751], [-0.7268, 0.6641, -0.175], [-0.7268, 0.6642, -0.1748], [-0.7268, 0.6642, -0.1747], [-0.7269, 0.6642, -0.1746], [-0.7269, 0.6641, -0.1746], [-0.7269, 0.6642, -0.1746], [-0.7269, 0.6642, -0.1745], [-0.727, 0.6641, -0.1744], [-0.7271, 0.6641, -0.1742], [-0.7272, 0.664, -0.1741], [-0.7272, 0.664, -0.174], [-0.7273, 0.6639, -0.174], [-0.7273, 0.6639, -0.1739], [-0.7273, 0.6639, -0.1739], [-0.7274, 0.6639, -0.1738], [-0.7274, 0.6638, -0.1737]]

        newStressSphere.addPolyline({
            positions: normals.map(n => {
                return {normal: new THREE.Vector3(n[0], n[1], n[2])}
            }),
            color: 0xffffff,
            lineWidth: 0.01
        })

        if (true) {

        }

        setRenderer(newRenderer);
        setScene(newScene);
        setCamera(newCamera);
        setControls(newControls);
        setStressSphere(newStressSphere);

        const animate = () => {
            requestAnimationFrame(animate);
            newControls.update();
            newRenderer.render(newScene, newCamera);
        };
        animate();

        const resizeObserver = new ResizeObserver(entries => {
            for (const entry of entries) {
                const { width, height } = entry.contentRect;
                newRenderer.setSize(width, height);
                newCamera.aspect = width / height;
                newCamera.updateProjectionMatrix();
            }
        });

        resizeObserver.observe(containerRef.current);

        return () => {
            resizeObserver.disconnect();
            containerRef.current?.removeChild(newRenderer.domElement);
            newRenderer.dispose();
        };
    }, []);

    return (
        <div className="h-full flex flex-col gap-4">
            <div className="flex-1 min-h-0">
                <div ref={containerRef} className="w-full h-full border rounded-lg" />
            </div>
            {/* <div className="flex gap-4">
                <button
                    className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                    onClick={() => {
                        if (stressSphere) {
                            stressSphere.clearIntegralCurves();
                            stressSphere.addIntegralCurve({ theta: Math.random() * 360, phi: Math.random() * 180 });
                        }
                    }}
                >
                    Add Random Integral Curve
                </button>
                <button
                    className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                    onClick={() => {
                        if (stressSphere) {
                            stressSphere.clearEquipotentialCurves();
                            stressSphere.addEquipotentialCurve({ theta: Math.random() * 360, phi: Math.random() * 180 });
                        }
                    }}
                >
                    Add Random Equipotential Curve
                </button>
            </div> */}
        </div>
    );
};

export default StressSphereViewer;